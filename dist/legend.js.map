{"version":3,"sources":["../src/legend.js"],"names":[],"mappings":"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","file":"legend.js","sourcesContent":["import angular from 'angular';\nimport _ from  'lodash';\nimport kbn from 'app/core/utils/kbn';\nimport $ from  'jquery';\nimport 'jquery.flot';\nimport 'jquery.flot.time';\n\nangular.module('grafana.directives').directive('piechartLegend', function(popoverSrv, $timeout) {\n  return {\n    link: function(scope, elem) {\n      var $container = $('<section class=\"graph-legend\"></section>');\n      var firstRender = true;\n      var ctrl = scope.ctrl;\n      var panel = ctrl.panel;\n      var data;\n      var seriesList;\n      var i;\n\n      ctrl.events.on('render', function() {\n        data = ctrl.series;\n        if (data) {\n          for(var i in data) {\n            data[i].color = ctrl.data[i].color;\n          }\n          render();\n        }\n      });\n\n      function mapNumeric(series, isRange) {\n        var label = series.label;\n\n        if (!isNaN(label)) {\n          var _value = parseInt(label, 10);\n          _.each( (isRange) ? ctrl.panel.rangeMaps : ctrl.panel.valueMaps, function(map) {\n            var cond = false;\n            if (isRange) {\n              if (!isNaN(map.from) && !isNaN(map.to)) {\n                var _from = parseInt(map.from, 10);\n                var _to = parseInt(map.to, 10);\n                cond = (_value >= _from && _value <= _to);\n              }\n            } else {\n              if (!isNaN(map.value)) {\n                var _ref = parseInt(map.value, 10);\n                cond = (_value == _ref);\n              }\n            }\n            if (cond) {\n              label = ctrl.replaceAll(map.text, \"{{value}}\", _value);\n              return false;\n            }\n          });\n        }\n\n        return label;\n      }\n      \n      function mapString(series, isRange) {\n        var label = series.label;\n\n        if (isNaN(label)) {\n          _.each( (isRange) ? ctrl.panel.rangeMaps : ctrl.panel.valueMaps, function(map) {\n            var cond = false;\n            if (isRange) {\n              if (isNaN(map.from) && isNaN(map.to)) {\n                cond = (label == map.from || label == map.to);\n              }\n            } else {\n              if (isNaN(map.value)) {\n                cond = (label == map.value);\n              }\n            }\n\n            if (cond) {\n              label = ctrl.replaceAll(map.text, \"{{value}}\", label);\n              return false;\n            }\n          });\n        }\n\n        return label;\n      }\n\n      function mapIpAddress(series, isRange) {\n        var ip2long = function(ip) {\n          var components;\n          if (components = ip.match(/^(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})$/)) {\n            var iplong = 0, power = 1;\n            for (var i=4; i>=1; i-=1) {\n              iplong += power * parseInt(components[i],10);\n              power *= 256;\n            }\n            return iplong;\n          } else {\n            return -1;\n          }\n        };\n\n        var label = series.label;\n        var _value = ip2long(label);\n        if (_value >= 0) {\n          _.each( (isRange) ? ctrl.panel.rangeMaps : ctrl.panel.valueMaps, function(map) {\n            var cond = false;\n            if (isRange) {\n              var mask_from, base_ip_from, mask_to, base_ip_to;\n              if ( (mask_from = map.from.match(/^(.*?)\\/(\\d{1,2})$/)) && ((base_ip_from=ip2long(mask_from[1])) >= 0) && (mask_to = map.to.match(/^(.*?)\\/(\\d{1,2})$/)) && ((base_ip_to=ip2long(mask_to[1])) >= 0) ) {\n                var freedom_from = Math.pow(2, 32 - parseInt(mask_from[2], 10));\n                var freedom_to = Math.pow(2, 32 - parseInt(mask_to[2], 10));\n                cond = ( (_value > base_ip_from) && (_value < base_ip_to + freedom_to - 1) );\n              } else {\n                cond = false;\n              }\n            } else {\n              var mask, base_ip;\n              if ( (mask = map.value.match(/^(.*?)\\/(\\d{1,2})$/)) && ((base_ip=ip2long(mask[1])) >= 0) ) {\n                var freedom = Math.pow(2, 32 - parseInt(mask[2], 10));\n                cond = ( (_value > base_ip) && (_value < base_ip + freedom - 1) );\n              } else {\n                cond = false;\n              }\n            }\n            \n            if (cond) {\n              label = ctrl.replaceAll(map.text, \"{{value}}\", label);\n              return false;\n            }\n          });\n        }\n\n        return label;\n      }\n\n      function mapLegendValues(series) {\n        // detect value mappings\n        var label = series.label;\n\n        // Value to Text\n        if (ctrl.panel.mappingType == 1) {\n          // Numeric\n          if (ctrl.panel.mappingDataType == 1) {\n            label = mapNumeric(series, false);\n          }\n          // String\n          else if (ctrl.panel.mappingDataType == 2) {\n            label = mapString(series, false);\n          }\n          // IP Address\n          else if (ctrl.panel.mappingDataType == 3) {\n            label = mapIpAddress(series, false);\n          }\n        }\n        // Range to Text\n        else if (ctrl.panel.mappingType == 2) {\n          if (ctrl.panel.mappingDataType == 1) {\n            label = mapNumeric(series, true);\n          }\n          // String\n          else if (ctrl.panel.mappingDataType == 2) {\n            label = mapString(series, true);\n          }\n          // IP Address\n          else if (ctrl.panel.mappingDataType == 3) {\n            label = mapIpAddress(series, true);\n          }\n        }\n\n        return label;\n      }\n\n      function getSeriesIndexForElement(el) {\n        return el.parents('[data-series-index]').data('series-index');\n      }\n\n      function toggleSeries(e) {\n        var el = $(e.currentTarget);\n        var index = getSeriesIndexForElement(el);\n        var seriesInfo = seriesList[index];\n        ctrl.toggleSeries(seriesInfo, e);\n      }\n\n      function sortLegend(e) {\n        var el = $(e.currentTarget);\n        var stat = el.data('stat');\n\n        if (stat !== panel.legend.sort) { panel.legend.sortDesc = null; }\n\n        // if already sort ascending, disable sorting\n        if (panel.legend.sortDesc === false) {\n          panel.legend.sort = null;\n          panel.legend.sortDesc = null;\n          render();\n          return;\n        }\n\n        panel.legend.sortDesc = !panel.legend.sortDesc;\n        panel.legend.sort = stat;\n        render();\n      }\n\n      function openColorSelector(e) {\n        // if we clicked inside poup container ignore click\n        if ($(e.target).parents('.popover').length) {\n          return;\n        }\n\n        var el = $(e.currentTarget).find('.fa-minus');\n        var index = getSeriesIndexForElement(el);\n        var series = seriesList[index];\n\n        $timeout(function() {\n          popoverSrv.show({\n            element: el[0],\n            position: 'bottom center',\n            template: '<gf-color-picker></gf-color-picker>',\n            model: {\n              series: series,\n              toggleAxis: function() {},\n              colorSelected: function(color) {\n                ctrl.changeSeriesColor(series, color);\n              }\n            },\n          });\n        });\n      }\n\n      function getTableHeaderHtml(statName) {\n        if (!panel.legend[statName]) { return \"\"; }\n        var html = '<th class=\"pointer\" data-stat=\"' + statName + '\">' + statName;\n\n        if (panel.legend.sort === statName) {\n          var cssClass = panel.legend.sortDesc ? 'fa fa-caret-down' : 'fa fa-caret-up' ;\n          html += ' <span class=\"' + cssClass + '\"></span>';\n        }\n\n        return html + '</th>';\n      }\n\n      function render() {\n        if(panel.legendType === 'On graph') {\n          $container.empty();\n          return;\n        }\n\n        if (firstRender) {\n          elem.append($container);\n          $container.on('click', '.graph-legend-icon', openColorSelector);\n          $container.on('click', '.graph-legend-alias', function(e) {\n            ctrl.handle_click_event(this, e, $(this).find(\"a\").html().trim());\n          });\n          $container.on('click', 'th', sortLegend);\n          firstRender = false;\n        }\n\n        seriesList = data;\n\n        $container.empty();\n\n        // Set min-width if side style and there is a value, otherwise remove the CSS propery\n        var width = panel.legendType === 'Right side' && panel.legend.sideWidth ? panel.legend.sideWidth + \"px\" : \"\";\n        $container.css(\"min-width\", width);\n\n        var tableLayout = panel.legendType === 'Right side' && panel.legend.values;\n        $container.toggleClass('graph-legend-table', tableLayout);\n\n        if (tableLayout) {\n          var header = '<tr><th colspan=\"2\" style=\"text-align:left\">Key</th>';\n          if (panel.legend.values) {\n            header += '<th class=\"pointer\">Value</th>';\n          }\n          header += '</tr>';\n          $container.append($(header));\n        }\n\n        if (panel.legend.sort) {\n          seriesList = _.sortBy(seriesList, function(series) {\n            return series.stats[panel.legend.sort];\n          });\n          if (panel.legend.sortDesc) {\n            seriesList = seriesList.reverse();\n          }\n        }\n\n        for (i = 0; i < seriesList.length; i++) {\n          var series = seriesList[i];\n\n          // ignore empty series\n          if (panel.legend.hideEmpty && series.allIsNull) {\n            continue;\n          }\n          // ignore series excluded via override\n          if (!series.legend) {\n            continue;\n          }\n\n          var label = mapLegendValues(series);\n\n          var html = '<div class=\"graph-legend-series';\n          html += '\" data-series-index=\"' + i + '\" data-series-key=\"' + series.label + '\">';\n          html += '<span class=\"graph-legend-icon\" style=\"float:none;\">';\n          html += '<i class=\"fa fa-minus pointer\" style=\"color:' + series.color + '\"></i>';\n          html += '</span>';\n\n          html += '<span class=\"graph-legend-alias\" style=\"float:none;\">';\n          html += '<a>' + label + '</a>';\n          html += '</span>';\n\n          if (tableLayout) {\n              html += '<div class=\"graph-legend-value\">' + series.formatValue(series.stats[ctrl.panel.valueName]) + '</div>'; \n              html += '</div><div class=\"clearfix\"></div>';\n          } else {\n            html += '</div>';\n          }\n\n          $container.append($(html));\n        }\n      }\n    }\n  };\n});\n"]}